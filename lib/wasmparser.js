!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@stellar/stellar-base")):"function"==typeof define&&define.amd?define(["@stellar/stellar-base"],t):"object"==typeof exports?exports.sorobanwasmparser=t(require("@stellar/stellar-base")):e.sorobanwasmparser=t(e["@stellar/stellar-base"])}(this,e=>(()=>{"use strict";var t={755(t){t.exports=e}},r={};function s(e){var a=r[e];if(void 0!==a)return a.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};s.d(a,{default:()=>d});var n=s(755);function i(e,t){const r=new o(e),s=[];for(;!r.eof;)s.push(t.read(r));return s}class o{constructor(e){if(!Buffer.isBuffer(e)){if(!(e instanceof Array))throw new Error("Source not specified");e=Buffer.from(e)}this._buffer=e,this._length=e.length,this._index=0}_buffer;_length;_index;get eof(){return this._index===this._length}advance(e){const t=this._index;if(this._index+=e,this._length<this._index)throw new Error("attempt to read outside the boundary of the buffer");const r=4-(e%4||4);if(r>0){for(let e=0;e<r;e++)if(0!==this._buffer[this._index+e])throw new Error("Invalid padding");this._index+=r}return t}rewind(){this._index=0}read(e){const t=this.advance(e);return this._buffer.subarray(t,t+e)}readInt32BE(){return this._buffer.readInt32BE(this.advance(4))}readUInt32BE(){return this._buffer.readUInt32BE(this.advance(4))}readBigInt64BE(){return this._buffer.readBigInt64BE(this.advance(8))}readBigUInt64BE(){return this._buffer.readBigUInt64BE(this.advance(8))}readFloatBE(){return this._buffer.readFloatBE(this.advance(4))}readDoubleBE(){return this._buffer.readDoubleBE(this.advance(8))}ensureInputConsumed(){if(this._index!==this._length)throw new Error("Invalid XDR contract typecast - source buffer not entirely consumed")}}class c{constructor(e){this.data=e}data;pointer=8;readCustomSections(){const e=[];for(;this.pointer<this.data.length;){const t=this.readUint8();let r=this.readVarUint32();if(0===t){const t=this.pointer,s=this.readString();r-=this.pointer-t,e.push({name:s,contents:this.data.subarray(this.pointer,this.pointer+r)})}this.pointer+=r}return e}readUint8(){return this.data.readUint8(this.pointer++)}readVarUint32(){let e=0,t=0;for(;;){let r=this.readUint8();if(e|=(127&r)<<t,t+=7,!(128&r))break}return e>>>0}readString(){const e=this.readVarUint32(),t=this.data.subarray(this.pointer,this.pointer+e);return this.pointer+=e,t.toString("utf-8")}}function u(e){const t={};for(const{_value:r}of e){const e=r.key().toString(),s=r.val().toString();switch(e){case"rsver":t.rustVersion=s;break;case"rssdkver":t.sdkVersion=s;break;default:t[e]=s}}return t}function p(e){return(new h).parse(e)}class h{constructor(){this.res={}}res;addSpec(e,t,r){let s=this.res[e];void 0===s&&(s=this.res[e]={}),r.call(this,t,s)}parse(e){for(const t of e){const e=t.value(),{_attributes:r}=e;switch(t._arm){case"functionV0":this.addSpec("functions",r,this.parseFunction);break;case"udtStructV0":this.addSpec("structs",r,this.parseStruct);break;case"udtUnionV0":this.addSpec("unions",r,this.parseUnion);break;case"udtEnumV0":this.addSpec("enums",r,this.parseEnum);break;case"udtErrorEnumV0":this.addSpec("errors",r,this.parseError);break;case"eventV0":this.addSpec("events",r,this.parseEvent);break;default:console.log("Unknown spec type: "+t._arm)}}return this.res}parseFunction(e,t){t[e.name.toString()]=this.withDocs({inputs:e.inputs.map(e=>this.parseFuncArgument(e)),outputs:e.outputs.map(e=>this.parseParameterType(e))},e)}parseStruct(e,t){const r={};for(const t of e.fields)this.parseParameter(t,r);t[this.parseStructName(e)]=this.withDocs({fields:r},e)}parseUnion(e,t){const r={};for(const t of e.cases){const e=t.value();r[e.name().toString()]=e.type?e.type().map(e=>this.parseParameterType(e)):[]}t[this.parseStructName(e)]=this.withDocs({cases:r},e)}parseEnum(e,t){const r={};for(const t of e.cases){const e=t.value();if(e.name)r[e.name().toString()]=e.value();else{const s=t._attributes;r[s.name.toString()]=this.withDocs({value:e},s)}}t[this.parseStructName(e)]=this.withDocs({cases:r},e)}parseError(e,t){for(const r of e.cases){const e=r._attributes;t[e.name.toString()]=this.withDocs({value:e.value},e)}}parseEvent(e,t){let r;switch(e.dataFormat.value){case 1:r="Vec";break;case 2:r="Map";break;default:r=e.dataFormat.name}const s={prefixTopics:e.prefixTopics.map(e=>e.toString()),params:e.params.map(e=>{const t=e._attributes,r={name:t.name.toString(),type:this.parseParameterType(t.type),location:0===t.location.value?"data":"topics"};return this.withDocs(r,t)}),dataFormat:r};t[this.parseStructName(e)]=this.withDocs(s,e)}parseParameterType(e){const t=e.switch().name;switch(t){case"scSpecTypeOption":return`Option<${this.parseParameterType(e.value().valueType())}>`;case"scSpecTypeBytesN":return`BytesN<${e.value().n()}>`;case"scSpecTypeVec":return`Vec<${this.parseParameterType(e.value().elementType())}>`;case"scSpecTypeMap":return`Map<${this.parseParameterType(e.value().keyType())}, ${this.parseParameterType(e.value().valueType())}>`;case"scSpecTypeResult":return`Result<${this.parseParameterType(e.value().okType())}, ${this.parseParameterType(e.value().errorType())}>`;case"scSpecTypeTuple":return`(${e.value().valueTypes().map(e=>this.parseParameterType(e)).join(", ")})`;case"scSpecTypeUdt":return e.value().name().toString();default:let r=t.replace("scSpecType","");return(/^[IU](8|16|32|64|128)$/.test(r)||"Bool"===r)&&(r=r.toLowerCase()),r}}parseStructName(e){let t=e.name.toString();return e.lib.length&&(t+=":"+e.lib.toString()),t}parseParameter(e,t){const r=e._attributes;t[r.name.toString()]=this.withDocs({type:this.parseParameterType(r.type)},r)}parseFuncArgument(e){const t=e._attributes;return this.withDocs({name:t.name.toString(),type:this.parseParameterType(t.type)},t)}withDocs(e,t){return t.doc?.length&&(e.doc=t.doc.toString()),e}}const d={parseContractMetadata:function(e){const t=new c(e).readCustomSections(),r={};for(const e of t)switch(e.name){case"contractenvmetav0":const t=n.xdr.ScEnvMetaEntry.fromXDR(e.contents).value()._attributes;r.interfaceVersion=`${t.protocol}.${t.preRelease}`;break;case"contractmetav0":Object.assign(r,u(i(e.contents,n.xdr.ScMetaEntry)));break;case"contractspecv0":Object.assign(r,p(i(e.contents,n.xdr.ScSpecEntry)));break;default:r[e.name]=e.contents.toString()}return r}};return a.default})());
//# sourceMappingURL=wasmparser.js.map